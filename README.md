# LoveNotes

---

# Документация по разработке PWA приложения "Creative Love Notes" (Mobile-first, Node.js Backend)

Документ описывает разработку персонализированного облачного дневника для пар с уникальными функциями. Приложение первоначально ориентировано на мобильные устройства с последующим выпуском браузерных версий.

---

## 1. Обзор проекта

**Название:** Creative Love Notes

**Концепция:**  
Приложение представляет собой персонализированный облачный дневник для пар, позволяющий:
- Обмениваться личными сообщениями.
- Анализировать эмоциональную окраску сообщений.
- Генерировать голосовые послания и визуализировать историю отношений.
- Решать интерактивные головоломки для восстановления секретных посланий.
- Планировать важные события с интерактивным календарём.

**Ключевые особенности:**
- **Mobile-first:** Первоначальная разработка для мобильных устройств с адаптацией под браузерную среду.
- **Туннелирование через Serveo:** Для упрощённого тестирования локальной разработки используется Serveo.
- **Нейросетевые функции:** Две функции с участием нейросети Mistral и две функции, реализующие интеллектуальные возможности без её участия.

---

## 2. Архитектура и стек технологий

### 2.1 Backend

**Язык и фреймворк:**
- **Node.js LTS (например, v18.x)**
- **Express.js** – минималистичный и высокопроизводительный веб-фреймворк для создания REST API.

**Дополнительные библиотеки и инструменты:**
- **Socket.io:** Для реализации WebSocket-уведомлений в реальном времени.
- **Sequelize ORM:** Для работы с базой данных (например, PostgreSQL).
- **Serveo:** Для туннелирования локального сервера и обеспечения удалённого доступа в процессе разработки.
- **Axios/Fetch:** Для интеграции с внешними API, включая API нейросети Mistral.
- **JWT (jsonwebtoken):** Для аутентификации и авторизации пользователей.
- **Winston или Pino:** Для логирования и мониторинга.

### 2.2 Frontend

**Для мобильных устройств:**
- **React Native:** Для создания кроссплатформенного мобильного приложения.
- **React Navigation:** Для управления навигацией в мобильном приложении.

**Для браузерной версии (планируется на следующем этапе):**
- **React 18 или выше:** Для создания PWA с использованием современных библиотек.
- **UI-библиотеки:** Material-UI или Tailwind CSS – выбор зависит от дизайна и требований к стилю.
- **Axios:** Для взаимодействия с backend API.

### 2.3 База данных и дополнительные сервисы

- **PostgreSQL:** Надёжная СУБД с использованием Sequelize.
- **Redis:** Для кэширования и хранения сессий (по необходимости).
- **Cloud Storage (например, AWS S3):** Для хранения аудио и других мультимедийных файлов.

---

## 3. Функциональные требования и описание компонентов

### 3.1 Основные функции приложения

1. **Анализ настроения с использованием нейросети Mistral**  
   - **Функция 1:** Автоматический анализ эмоциональной окраски входящих сообщений (позитив/негатив/нейтрально) через интеграцию с API Mistral.
   - **Функция 2:** Генерация рекомендаций по ответам на основе анализа текста с применением нейросети Mistral (например, предложения для поддержания эмоционального баланса).

2. **Голосовой обмен и синтез романтических посланий**  
   - Запись аудио через Web Speech API (на мобильном устройстве).
   - Отправка аудиофайлов на backend для транскрипции и синтеза голосового ответа с использованием специализированных TTS-сервисов.

3. **Секретное послание-пазл**  
   - Преобразование исходного текста в головоломку с элементами шифрования, требующими решения для восстановления оригинального сообщения.

4. **Умные уведомления**  
   - Использование Socket.io для мгновенной доставки уведомлений с рекомендациями по ответу при изменении эмоционального тона сообщений.

5. **Интерактивный календарь отношений**  
   - Планирование и напоминание о важных датах (годовщина, день знакомства) с рекомендациями по сюрпризам и поздравлениям.

### 3.2 Дополнительные интересные функции

**С использованием нейросети Mistral:**
- **Функция интеллектуального дневника:**  
  Автоматическая генерация сводных отчётов о ключевых моментах отношений с использованием анализа истории переписки через API Mistral.
  
- **Функция эмоциональной визуализации:**  
  Динамическое создание графиков и временной линии настроений с интерпретацией на основе данных, полученных от нейросети Mistral.

**Без использования нейросети Mistral:**
- **Функция рекомендаций на основе поведения:**  
  Рекомендательная система, анализирующая действия пользователя (например, лайки, просмотренные сообщения) для предложения новых идей и событий с использованием алгоритмов машинного обучения (без Mistral).
  
- **Функция креативного контента:**  
  Генерация креативных идей для романтических посланий или подарков, основанная на анализе популярных трендов и пользовательских предпочтениях с использованием статистических методов и rule-based систем.

---

## 4. API эндпоинты

Все эндпоинты документируются с помощью Swagger (например, через библиотеку swagger-ui-express) и включают подробное описание входных/выходных параметров.

### Примеры эндпоинтов:

- **Аутентификация:**
  - `POST /auth/signup` – Регистрация пользователя.
  - `POST /auth/login` – Авторизация и выдача JWT-токена.

- **Работа с сообщениями:**
  - `GET /messages` – Получение списка сообщений с анализом настроения.
  - `POST /messages` – Отправка нового сообщения с автоматическим анализом.
  - `PUT /messages/:id` – Редактирование сообщения.
  - `DELETE /messages/:id` – Удаление сообщения.

- **Голосовые сообщения:**
  - `POST /voice/record` – Отправка аудиофайла для транскрипции.
  - `POST /voice/synthesize` – Синтез текста в аудио.

- **Капсула воспоминаний:**
  - `POST /capsule/generate` – Инициирование генерации отчёта.
  - `GET /capsule` – Получение сгенерированных капсул.

- **Секретное послание-пазл:**
  - `POST /puzzle/generate` – Генерация головоломки.
  - `POST /puzzle/solve` – Проверка решения и восстановление оригинального сообщения.

- **Умные уведомления:**
  - **Socket.io /notifications** – Подключение для получения уведомлений в реальном времени.
  - `POST /notifications/test` – Тестовый эндпоинт для отладки уведомлений.

- **Дополнительные функции:**
  - `POST /diary/summary` – Генерация интеллектуального дневника (на основе Mistral).
  - `GET /visualization/emotions` – Получение данных для эмоциональной визуализации (на основе Mistral).
  - `GET /recommendations/behavior` – Рекомендации на основе пользовательского поведения (без Mistral).
  - `GET /creative/ideas` – Генерация креативных идей для романтических посланий (без Mistral).

---

## 5. Структура проекта

```
/project-root
├── backend/
│   ├── app.js                  # Точка входа Express-приложения
│   ├── config/                 
│   │   └── config.js           # Конфигурация приложения (поддержка .env)
│   ├── controllers/            # Контроллеры для API эндпоинтов
│   ├── models/                 # Модели данных (Sequelize)
│   ├── routes/                 # Маршруты API (включая аутентификацию, сообщения, голосовые и проч.)
│   ├── services/               # Логика бизнес-процессов (интеграция с Mistral, транскрипция, синтез и т.д.)
│   ├── middlewares/            # JWT-аутентификация, логирование и прочее
│   ├── utils/                  # Вспомогательные утилиты (работа с Serveo, планировщик задач)
│   └── package.json            # Зависимости Node.js
├── mobile/
│   ├── app/                    # Исходный код React Native приложения
│   ├── package.json            # Зависимости для мобильной версии
└── web/
    ├── public/                 # Статические файлы, manifest для PWA
    ├── src/                    
    │   ├── index.js            # Точка входа React-приложения для браузера
    │   ├── components/         # UI-компоненты
    │   ├── services/           # Модуль для работы с API (Axios)
    │   └── utils/              # Утилиты (например, работа с уведомлениями)
    └── package.json            # Зависимости веб-версии
```

---

## 6. Локальное развертывание и настройка окружения

### 6.1 Требования к окружению

- **ОС:** Windows 10 (или другая ОС)
- **Node.js:** LTS версия (например, v18.x)
- **Git:** последней версии

### 6.2 Настройка backend

1. **Клонирование репозитория:**
   ```bash
   git clone <URL вашего репозитория>
   cd project-root/backend
   ```

2. **Установка зависимостей:**
   ```bash
   npm install
   ```

3. **Настройка переменных окружения:**
   Создайте файл `.env` с необходимыми настройками, например:
   ```
   PORT=8000
   DATABASE_URL=postgres://user:password@localhost:5432/creative_love_notes
   JWT_SECRET=your_jwt_secret_key
   MISTRAL_API_KEY=your_mistral_api_key
   TTS_API_KEY=your_tts_api_key
   ```
   
4. **Запуск сервера:**
   ```bash
   npm start
   ```

5. **Туннелирование через Serveo:**
   Для доступа к локальному серверу извне используйте команду:
   ```bash
   ssh -R 80:localhost:8000 serveo.net
   ```
   Это создаст публичный URL для тестирования мобильных устройств.

### 6.3 Настройка мобильного приложения (React Native)

1. **Клонирование репозитория:**
   ```bash
   cd project-root/mobile
   ```

2. **Установка зависимостей:**
   ```bash
   npm install
   ```
   
3. **Запуск приложения:**
   ```bash
   npx react-native run-android
   ```
   или
   ```bash
   npx react-native run-ios
   ```

### 6.4 Настройка веб-версии

После успешной разработки мобильного приложения, веб-версия разрабатывается в папке `/web`:
1. **Установка зависимостей:**
   ```bash
   cd project-root/web
   npm install
   ```
   
2. **Запуск dev-сервера:**
   ```bash
   npm start
   ```

---

## 7. Дополнительные аспекты

### 7.1 Безопасность

- **JWT-аутентификация** для защиты API.
- **Валидация входных данных** с помощью библиотек вроде Joi или express-validator.
- **Шифрование и безопасное хранение данных,** а также использование HTTPS (при запуске в продакшене).

### 7.2 Мониторинг и аналитика

- Логирование запросов и ошибок (Winston/Pino).
- Интеграция с системами мониторинга (например, Sentry).
- Отслеживание активности пользователей и уведомлений через Socket.io.

### 7.3 Тестирование

- **Unit и интеграционные тесты:** Используйте Mocha, Chai, Jest для тестирования backend и frontend.
- **E2E тестирование:** Например, с Cypress для веб-версии.

---

## 8. Заключение

Эта документация описывает разработку PWA-приложения «Creative Love Notes» с использованием backend на Node.js, обеспечивающего высокую производительность и масштабируемость. Приложение ориентировано на мобильные устройства с последующим выпуском браузерной версии. Среди ключевых особенностей — туннелирование через Serveo для упрощённого доступа к локальному серверу, а также интеграция функций с нейросетью Mistral (анализ настроения, генерация рекомендаций и визуализация) и интеллектуальные функции без её участия (рекомендации на основе поведения, генерация креативных идей). Такой подход позволяет создать эффективное, гибкое и масштабируемое решение для персонализированного дневника отношений.

---

Данная версия документации отражает современные подходы в разработке, позволяя адаптировать стек технологий под реальные потребности проекта и обеспечить эффективную работу на мобильных и веб-платформах.
